<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#1a1a2e">
    <title>LIFT</title>
    <link rel="icon" type="image/svg+xml" href="logo.svg">
    <link rel="stylesheet" href="styles.css?v=1.2">
    <link rel="manifest" href="manifest.json">
</head>
<body>
    <!-- App Container -->
    <div id="app">
        <!-- Header -->
        <header class="header">
            <div style="display:flex; align-items:center; gap:10px;">
                <img src="logo.svg" alt="LIFT Logo" style="height: 28px; width: 28px;">
                <h1>LIFT</h1>
            </div>
        </header>

        <!-- Navigation Tabs -->
        <nav class="tabs">
            <button class="tab active" data-view="workout">Workout</button>
            <button class="tab" data-view="exercises">√úbungen</button>
            <button class="tab" data-view="stats">Statistik</button>
            <button class="tab" data-view="coach">Coach</button>
            <button class="tab" data-view="settings">‚öôÔ∏è</button>
        </nav>

        <!-- Main Content -->
        <main class="content">
            <!-- Loading State -->
            <div id="loading" class="loading">
                <div class="spinner"></div>
                <p>Lade Daten...</p>
            </div>

            <!-- Error State -->
            <div id="error" class="error" style="display: none;"></div>

            <!-- Workout View -->
            <section id="workoutView" class="view active">
                <!-- Current Workout Header -->
                <div class="workout-header">
                    <div class="workout-date" id="dateSelector" style="cursor: pointer;">
                        <span id="currentDate">Heute</span>
                        <span style="color: var(--text-muted); font-size: 12px;">antippen zum √Ñndern</span>
                    </div>
                </div>

                <!-- Exercise List (Overview with last weights) -->
                <div id="exerciseList" class="exercise-list">
                    <!-- Dynamically filled -->
                </div>

                <!-- Add Exercise Button -->
                <button id="addExerciseBtn" class="add-exercise-btn">
                    + √úbung hinzuf√ºgen
                </button>
            </section>

            <!-- Exercises View (All exercises) -->
            <section id="exercisesView" class="view">
                <div class="search-bar">
                    <input type="text" id="exerciseSearch" placeholder="√úbung suchen...">
                </div>
                <div id="allExercisesList" class="all-exercises-list">
                    <!-- Dynamically filled -->
                </div>
                <button id="createExerciseBtn" class="primary-btn">
                    + Neue √úbung erstellen
                </button>
            </section>

            <!-- Stats View -->
            <section id="statsView" class="view">
                <div class="dashboard-grid">
                    <!-- KPI Row -->
                    <div id="kpiGrid" class="kpi-grid">
                        <!-- Filled by JS -->
                    </div>

                    <!-- Heatmap Row -->
                    <div class="dashboard-card">
                        <h3>Konsistenz</h3>
                        <div class="heatmap-scroll">
                            <div id="heatmapContainer" class="heatmap-container">
                                <!-- Filled by JS -->
                            </div>
                        </div>
                    </div>
                    
                    <!-- Charts Row -->
                    <div class="dashboard-card">
                        <h3>Muskel-Balance (S√§tze)</h3>
                        <div class="chart-wrapper">
                            <canvas id="muscleChart"></canvas>
                        </div>
                    </div>

                    <div class="dashboard-card">
                        <div class="chart-header">
                            <h3>Fortschritt</h3>
                            <div class="chart-controls">
                                <select id="chartExerciseSelect" class="chart-select">
                                    <option value="">√úbung w√§hlen...</option>
                                </select>
                                <div class="toggle-wrapper" title="Zeige gesch√§tztes 1 Rep Max">
                                    <span>Gewicht</span>
                                    <label class="switch-sm">
                                        <input type="checkbox" id="show1RMToggle">
                                        <span class="slider round"></span>
                                    </label>
                                    <span>1RM</span>
                                </div>
                            </div>
                        </div>
                        <div class="chart-wrapper">
                            <canvas id="progressChart"></canvas>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Coach View -->
            <section id="coachView" class="view">
                <div class="coach-container">
                    <!-- Goals Section (collapsible) -->
                    <div class="coach-goals-section">
                        <button class="goals-toggle" onclick="toggleGoalsSection()">
                            <span>üéØ Meine Fitnessziele</span>
                            <span class="toggle-icon">‚ñº</span>
                        </button>
                        <div id="goalsContent" class="goals-content" style="display: none;">
                            <div class="goals-form">
                                <div class="input-group">
                                    <label>Deine Ziele</label>
                                    <textarea id="userGoals" placeholder="z.B. Muskelaufbau, Kraft steigern, Abnehmen..."></textarea>
                                </div>
                                <div class="input-group">
                                    <label>Erfahrungslevel</label>
                                    <select id="experienceLevel">
                                        <option value="">Bitte w√§hlen...</option>
                                        <option value="beginner">Anf√§nger (< 1 Jahr)</option>
                                        <option value="intermediate">Fortgeschritten (1-3 Jahre)</option>
                                        <option value="advanced">Erfahren (3+ Jahre)</option>
                                    </select>
                                </div>
                                <div class="input-group">
                                    <label>Trainingsfrequenz</label>
                                    <select id="trainingFrequency">
                                        <option value="">Bitte w√§hlen...</option>
                                        <option value="1-2">1-2x pro Woche</option>
                                        <option value="3-4">3-4x pro Woche</option>
                                        <option value="5+">5+ pro Woche</option>
                                    </select>
                                </div>
                                <button class="primary-btn" onclick="saveGoals()">Ziele speichern</button>
                            </div>
                        </div>
                    </div>

                    <!-- Chat Section -->
                    <div class="coach-chat-section">
                        <div class="chat-header">
                            <div class="chat-title">
                                <span id="chatTitle">üí¨ Neuer Chat</span>
                            </div>
                            <div class="chat-actions">
                                <button class="icon-btn" onclick="showConversationHistory()" title="Verlauf">üìã</button>
                                <button class="icon-btn" onclick="startNewConversation()" title="Neuer Chat">‚ûï</button>
                            </div>
                        </div>
                        
                        <div id="chatMessages" class="chat-messages">
                            <div class="chat-welcome">
                                <div class="coach-avatar">üèãÔ∏è</div>
                                <h3>Hallo! Ich bin dein TrainBot.</h3>
                                <p>Ich kann dir helfen mit:</p>
                                <ul>
                                    <li>üìã Trainingspl√§ne erstellen</li>
                                    <li>üìä Fortschritt analysieren</li>
                                    <li>üí° Trainingsempfehlungen</li>
                                    <li>‚ùì Fragen beantworten</li>
                                </ul>
                                <div class="quick-prompts">
                                    <button onclick="sendQuickPrompt('Erstelle mir einen Trainingsplan f√ºr diese Woche')">üìã Trainingsplan erstellen</button>
                                    <button onclick="sendQuickPrompt('Analysiere meinen Fortschritt der letzten Wochen')">üìä Fortschritt analysieren</button>
                                    <button onclick="sendQuickPrompt('Was sollte ich heute trainieren?')">üí™ Workout-Empfehlung</button>
                                </div>
                            </div>
                        </div>

                        <div class="chat-input-section">
                            <div class="chat-input-container">
                                <textarea id="chatInput" placeholder="Frag deinen Coach..." rows="1" onkeydown="handleChatKeydown(event)"></textarea>
                                <button id="sendChatBtn" onclick="sendChatMessage()" disabled>
                                    <span class="send-icon">‚û§</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Settings View -->
            <section id="settingsView" class="view">
                <div class="settings-container">
                    <h2>Einstellungen</h2>
                    
                    <div class="settings-group">
                        <h3>Pausen-Timer</h3>
                        <div class="setting-item">
                            <label>Timer automatisch starten</label>
                            <label class="switch">
                                <input type="checkbox" id="settingRestTimerEnabled" checked>
                                <span class="slider round"></span>
                            </label>
                        </div>
                        <div class="setting-item">
                            <label>Standard Pausenzeit (Sekunden)</label>
                            <input type="number" id="settingDefaultRestTime" value="90" min="5" step="5">
                        </div>
                    </div>

                    <div class="settings-group">
                        <h3>Daten</h3>
                        <div class="setting-item">
                            <label>Trainingsdaten exportieren</label>
                            <button class="small-btn" onclick="exportDataToCSV()">CSV Export</button>
                        </div>
                    </div>

                    <div class="settings-footer">
                        <p>Version 1.2.0</p>
                        <p>LIFT App</p>
                    </div>
                </div>
            </section>
        </main>
        
        <!-- Global Timer Overlay -->
        <div id="restTimerOverlay" class="timer-overlay" style="display: none;">
            <div class="timer-content">
                <div class="timer-label">Pause</div>
                <div id="timerDisplay" class="timer-display">01:30</div>
                <div class="timer-controls">
                    <button onclick="adjustTimer(-10)">-10s</button>
                    <button class="stop-btn" onclick="stopRestTimer()">Stopp</button>
                    <button onclick="adjustTimer(10)">+10s</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Container -->
    <div id="modalContainer"></div>

    <!-- Exercise Detail Modal (for adding sets) -->
    <div id="exerciseModal" class="modal" style="display: none;">
        <div class="modal-content exercise-detail">
            <div class="modal-header">
                <h2 id="exerciseModalTitle">√úbung</h2>
                <button class="close-modal">√ó</button>
            </div>
            <div class="modal-body">
                <!-- Last workout info -->
                <div id="lastWorkoutInfo" class="last-workout-info">
                    <span class="label">Letztes Training:</span>
                    <span id="lastWorkoutDate">-</span>
                </div>

                <!-- Sets list -->
                <div id="setsContainer" class="sets-container">
                    <!-- Existing sets for today -->
                </div>

                <!-- Quick add set -->
                <div class="quick-add-set">
                    <h3>Neuer Satz</h3>
                    <div class="set-inputs">
                        <div class="input-group">
                            <label>Gewicht (kg)</label>
                            <div class="number-input">
                                <button class="decrement" data-field="weight">-</button>
                                <input type="number" id="newWeight" step="1" min="0" value="0">
                                <button class="increment" data-field="weight">+</button>
                            </div>
                        </div>
                        <div class="input-group">
                            <label>Wiederholungen</label>
                            <div class="number-input">
                                <button class="decrement" data-field="reps">-</button>
                                <input type="number" id="newReps" min="0" value="0">
                                <button class="increment" data-field="reps">+</button>
                            </div>
                        </div>
                    </div>
                    <div class="difficulty-selector">
                        <label>Anstrengung:</label>
                        <div class="difficulty-options">
                            <button class="diff-btn" data-value="Leicht" title="Leicht">üü¢</button>
                            <button class="diff-btn active" data-value="Mittel" title="Mittel">üü°</button>
                            <button class="diff-btn" data-value="Schwer" title="Schwer">üü†</button>
                            <button class="diff-btn" data-value="Sehr schwer" title="Sehr schwer">üî¥</button>
                        </div>
                    </div>
                    <button id="addSetBtn" class="primary-btn full-width">
                        Satz hinzuf√ºgen
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="app.js?v=1.2"></script>
</body>
</html>
